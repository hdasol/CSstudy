# 데드락, 경쟁상태

## 동현

### 교착상태 (Deadlock)

서로 다른 프로세스가 점유하고 있는 자원을 서로 필요로하며 기다리고 있는 현상을 의미합니다. 모두가 상대의 작업이 끝나기만을 기다리고 있기 때문에 영구적으로 blocking됩니다.

### 교착상태는 어떤 조건에서 발생하나요?

- `상호 배제`: 한 번에 한 개의 프로세스만이 공유 자원을 사용할 수 있습니다.
- `점유대기`: 자원을 보유하고 있는 프로세스는 다른 자원을 요청하며 기다립니다.
- `비선점`: 프로세스에 의해 점유된 자원을 다른 프로세스가 빼앗을 수 없습니다.
- `환형대기`: 각 프로세스가 순차적으로 다음 프로세스가 필요로하는 자원을 가지고 있는 상태여야 합니다.

A프로세스와 B프로세스가 있다고 가정합니다.  
A프로세스가 필요로 하는 자원을 B프로세스에서 점유하고 있는데, 해당 자원을 빼앗지도 못하고(`비선점`), 같이 쓸 수도 없기 때문에(`상호 배제`) B프로세스가 자원을 반납할 때 까지 무한정 기다리는 방법(`점유대기`)뿐이 없는 것입니다. 하지만, B프로세스 역시 A프로세스가 사용하고 있는 자원이 필요한 상태(`환형대기`)이기 때문에 서로 기다리게 됩니다.

### 교착상태 해결 방법

- `예방`기법이 있습니다. 애초에 교착상태가 발생하지 않도록 교착상태가 발생 가능한 전제 조건을 파괴하는 방법입니다. 하지만, 해당 조건들을 바꾸는 것은 더 큰 문제를 야기할 수 있기 때문에 좋지 않은 방법이라고 생각합니다.

- `회피`기법이 있습니다. 교착상태가 발생할 수 있음을 인지하고, 교착 상태에 안전한지 아닌지를 판단합니다. 안전하지 않은 상태라면 안전해질때까지 프로세스를 실행하지 않는 방법입니다.

- 교착 상태가 발생했을 경우 어떤 프로세스에서 발생했는지를 `발견하고 회복`하는 방법도 있습니다. 자원 할당 그래프 등을 이용한 알고리즘을 통해 발견합니다. 이후, 교착상태의 모든 프로세스를 순차적으로 종료하거나 일괄 종료, 혹은 하나씩 선점하는 방식을 택하거나 롤백하는 방식을 취하기도 합니다.
  - 자원 선점시, 프로세스의 우선순위나 중요도 혹은 필요 자원의 수에 따라 선점한다.
  - 한 프로세스가 계속해서 자원 선점 대상이 되는 기아현상이 발생하지 않도록 조심해야한다.

### 경쟁상태 (Race Condition)

프로세스끼리 하나의 자원을 가지기 위해 동시에 접근할 때 발생하는 문제입니다. 공유자원의 다중 접근 제어가 제대로 되지 않아, 조작의 순서에 따른 의도치 않은 결과를 보일 수 있습니다. 교착 상태의 한 종류입니다.

### 임계 구역 (critical section)

각 프로세스에서 공유 데이터에 접근하는 코드 영역입니다. 특정 프로세스가 임계 구역에 접근했을 경우, 다른 프로세스는 임계 구역 내부에서 사용되는 리소스에 접근할 수 없습니다.

### 참고 자료

- [경쟁상태, 교착상태](https://wonjayk.tistory.com/251)
- [교착상태와 경쟁상태](https://velog.io/@jinho0705/%EA%B5%90%EC%B0%A9-%EC%83%81%ED%83%9C%EC%99%80-%EA%B2%BD%EC%9F%81-%EC%83%81%ED%83%9C)
